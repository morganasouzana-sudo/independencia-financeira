<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Planejamento Financeiro</title>

<style>
body { font-family:Segoe UI,Arial; background:#f4f6f8; padding:20px; }
.container { max-width:900px; margin:auto; background:#fff; padding:25px; border-radius:12px; }
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:15px; }
input { padding:8px; border-radius:6px; border:1px solid #ccc; }
button { padding:14px; margin-top:15px; width:100%; background:#2ecc71; color:#fff; border:none; border-radius:8px; cursor:pointer; }
.card { background:#ecf0f1; padding:20px; border-radius:8px; margin-top:20px; }
.ok { border-left:6px solid #2ecc71; }
.no { border-left:6px solid #e74c3c; }
</style>
</head>

<body>
<div class="container">

<h1>Planejamento de Independ√™ncia Financeira</h1>

<div class="grid">
  <input id="patrimonio" placeholder="Patrim√¥nio atual" oninput="formatarMoeda(this)">
  <input id="aporte" placeholder="Aporte mensal" oninput="formatarMoeda(this)">
  <input id="anosAcc" type="number" placeholder="Anos de acumula√ß√£o">
  <input id="saque" placeholder="Saque mensal" oninput="formatarMoeda(this)">
  <input id="anosUsu" type="number" placeholder="Anos de usufruto">
  <input id="retorno" type="number" placeholder="Retorno real (%)">
  <input id="margem" type="number" placeholder="Margem de seguran√ßa (%)" value="20">
</div>

<label><input type="radio" name="modo" value="real" checked> Valores reais</label><br>
<label><input type="radio" name="modo" value="nominal"> Valores nominais</label>

<div id="inflacaoBox" style="display:none;margin-top:10px;">
  <input id="inflacao" type="number" placeholder="Infla√ß√£o (%)" value="4">
</div>

<button onclick="executar()">Simular planejamento</button>

<div id="resumo" class="card"></div>

<button onclick="window.open('detalhes.html','_blank')">
  üîç Ver an√°lise detalhada
</button>

</div>

<script src="core.js"></script>
<script>
/* ===== M√ÅSCARA DE MOEDA ===== */
function formatarMoeda(input) {
  let v = input.value.replace(/\D/g,"");
  if (!v) { input.value=""; return; }
  v = (v/100).toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".");
  input.value = v;
}
function moeda(v){
  return Number((v||"").replace(/\./g,"").replace(",",".")||0);
}

/* ===== TOGGLE INFLA√á√ÉO ===== */
document.querySelectorAll("input[name='modo']").forEach(r=>{
  r.onchange = () => inflacaoBox.style.display =
    r.checked && r.value==="nominal" ? "block" : "none";
});

/* ===== EXECUTAR ===== */
function executar(){
  const dados = {
    patrimonio: moeda(patrimonio.value),
    aporte: moeda(aporte.value),
    anosAcc:+anosAcc.value,
    saque: moeda(saque.value),
    anosUsu:+anosUsu.value,
    retorno:+retorno.value/100,
    margem:+margem.value/100,
    modo:document.querySelector("input[name='modo']:checked").value,
    inflacao:+inflacao.value/100 || 0
  };

  const r = simularPlano(dados);

  resumo.className = "card " + (r.sobra>=0 && r.durou ? "ok" : "no");
  resumo.innerHTML = `
    <h3>Resumo do plano</h3>
    <p>Patrim√¥nio estimado: <strong>R$ ${r.patrimonioFinal.toLocaleString("pt-BR")}</strong></p>
    <p>Necess√°rio (com margem): <strong>R$ ${r.necessario.toLocaleString("pt-BR")}</strong></p>
    <p>${r.sobra>=0?"‚úÖ Sobra":"‚ùå Falta"} 
       <strong>R$ ${Math.abs(r.sobra).toLocaleString("pt-BR")}</strong></p>
    <p>${r.durou?"O dinheiro dura todo o per√≠odo":"O dinheiro acaba antes do fim"}</p>
  `;

  localStorage.setItem("plano", JSON.stringify(dados));
}
</script>

</body>
</html>
