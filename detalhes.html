<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>An√°lise Detalhada</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: Segoe UI, Arial, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}

.container {
  max-width: 1000px;
  margin: auto;
  background: #fff;
  padding: 25px;
  border-radius: 12px;
}

.card {
  background: #ecf0f1;
  padding: 20px;
  border-radius: 8px;
  margin-top: 20px;
}

canvas {
  margin-top: 30px;
}
</style>
</head>

<body>
<div class="container">

<h1>An√°lise detalhada do plano</h1>

<div class="card" id="risco"></div>
<div class="card" id="crise"></div>

<canvas id="grafico"></canvas>

</div>

<script src="core.js"></script>
<script>
/* ===== CARREGA DADOS ===== */
const dados = JSON.parse(localStorage.getItem("plano"));

if (!dados) {
  document.body.innerHTML = "<h2>Nenhum plano encontrado. Volte para a tela principal.</h2>";
  throw new Error("Plano n√£o encontrado no localStorage");
}

/* ===== RISCO DE RU√çNA ===== */
const risco = riscoRuina(dados);
document.getElementById("risco").innerHTML = `
  <h3>üßÆ Risco de ru√≠na</h3>
  <p>Probabilidade estimada de falha: 
     <strong>${risco.toFixed(1)}%</strong>
  </p>
`;

/* ===== SIMULA√á√ÉO DE CRISE ===== */
const crise = simularCrise(dados);
document.getElementById("crise").innerHTML = `
  <h3>üîÑ Simula√ß√£o de crise severa</h3>
  <p>${crise 
    ? "‚úÖ O plano sobrevive mesmo com uma crise forte no in√≠cio do usufruto." 
    : "‚ùå Uma crise severa no in√≠cio do usufruto quebra o plano."}
  </p>
`;

/* ===== GR√ÅFICO ===== */
let labels = [];
let valores = [];

let p = dados.patrimonio;

for (let i = 1; i <= dados.anosAcc; i++) {
  p = p * (1 + dados.retorno) + dados.aporte * 12;
  labels.push("Ano " + i);
  valores.push(p);
}

new Chart(document.getElementById("grafico"), {
  type: "line",
  data: {
    labels: labels,
    datasets: [{
      label: "Evolu√ß√£o do Patrim√¥nio",
      data: valores,
      borderWidth: 3
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { position: "bottom" }
    }
  }
});
</script>

</body>
</html>
